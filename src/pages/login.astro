---
import Layout from '../components/Layout.astro';
---

<Layout title="Login - TubeGist">
	<main class="container">
		<div class="login-container">
			<header class="login-header">
				<h1>TubeGist</h1>
				<p>Please enter the access password</p>
			</header>

			<form id="login-form" class="login-form">
				<div class="form-group">
					<label for="password">Password</label>
					<input 
						type="password" 
						id="password" 
						name="password" 
						placeholder="Enter password"
						required
					/>
				</div>
				<button type="submit" class="login-btn">Access TubeGist</button>
			</form>

			<div id="error-message" class="error-message" style="display: none;"></div>
		</div>
	</main>

	<script>
		document.addEventListener('DOMContentLoaded', () => {
			// Check if already authenticated
			checkAuth();
			
			const form = document.getElementById('login-form');
			form?.addEventListener('submit', handleLogin);
		});

		async function checkAuth() {
			try {
				const response = await fetch('/api/auth');
				const result = await response.json();
				
				if (result.authenticated) {
					window.location.href = '/';
				}
			} catch (error) {
				console.error('Auth check error:', error);
			}
		}

		async function handleLogin(e) {
			e.preventDefault();
			
			const formData = new FormData(e.target);
			const password = formData.get('password');
			
			const loginBtn = document.querySelector('.login-btn');
			const errorMessage = document.getElementById('error-message');
			
			loginBtn.textContent = 'Authenticating...';
			loginBtn.disabled = true;
			errorMessage.style.display = 'none';
			
			try {
				const response = await fetch('/api/auth', {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json',
					},
					body: JSON.stringify({ password }),
				});
				
				const result = await response.json();
				
				if (result.success) {
					window.location.href = '/';
				} else {
					errorMessage.textContent = result.error || 'Authentication failed';
					errorMessage.style.display = 'block';
				}
			} catch (error) {
				errorMessage.textContent = 'Connection error. Please try again.';
				errorMessage.style.display = 'block';
			} finally {
				loginBtn.textContent = 'Access TubeGist';
				loginBtn.disabled = false;
			}
		}
	</script>

	<style>
		.login-container {
			max-width: 400px;
			margin: 100px auto;
			text-align: center;
		}

		.login-header {
			margin-bottom: 40px;
		}

		.login-header h1 {
			font-family: var(--font-display);
			font-size: 2.5rem;
			color: var(--color-accent);
			margin-bottom: 10px;
		}

		.login-header p {
			font-family: var(--font-sans);
			color: var(--color-text-light);
			font-size: 1.1rem;
		}

		.login-form {
			background-color: var(--color-bg-light);
			border: 1px solid var(--color-border);
			padding: 40px;
			border-radius: 4px;
			margin-bottom: 20px;
		}

		.form-group {
			margin-bottom: 25px;
			text-align: left;
		}

		.login-btn {
			width: 100%;
			padding: 15px;
			font-family: var(--font-sans);
			font-size: 1.1rem;
			font-weight: 600;
			color: white;
			background-color: var(--color-accent);
			border: none;
			border-radius: 2px;
			cursor: pointer;
			transition: background-color 0.2s;
			text-transform: uppercase;
			letter-spacing: 0.5px;
		}

		.login-btn:hover:not(:disabled) {
			background-color: #a93226;
		}

		.login-btn:disabled {
			background-color: var(--color-text-light);
			cursor: not-allowed;
		}

		.error-message {
			background-color: #fdf2f2;
			border: 1px solid #f5c6cb;
			color: #721c24;
			padding: 12px 16px;
			border-radius: 4px;
			font-family: var(--font-sans);
			font-size: 0.9rem;
		}
	</style>
</Layout>